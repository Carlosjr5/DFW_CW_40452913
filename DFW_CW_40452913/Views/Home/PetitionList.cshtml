<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petitions List</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <allmain aria-labelledby="title">
        <div class="filter-wrapper">
            <label for="sortSelect">Sort by:</label>
            <select id="sortSelect" onchange="sortPetitions(this.value)">
                <option value="default">Default</option>
                <option value="mostVoted">Most Voted</option>
                <option value="leastVoted">Least Voted</option>
            </select>
        </div>
        <div class="table-wrapper">
            <table class="table">
                <thead>
                    <tr>
                         @if (User.IsInRole("admin"))
                        {
                            <th>Title</th>
                            <th>Votes</th>
                            <th>Actions</th>
                        }
                        else{
                            <th>Title</th>
                            <th>Votes</th>
                            }
                        </tr>
                </thead>
                <tbody>
                    @foreach (var petition in Model)
                    {  @if (User.IsInRole("admin"))
                        {
                            <tr>
                                <td><a href="/Home/PetitionDetails/@petition.Id">@petition.Title</a></td>
                                <td>@petition.Votes</td>
                                <td><button style="background-color:darkred; color:white" onclick="deletePetition(@petition.Id)">Delete</button></td>
                            </tr>
                        }else{
                            <tr>
                                <td><a href="/Home/PetitionDetails/@petition.Id">@petition.Title</a></td>
                                <td>@petition.Votes</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </allmain>

    <script>
        function sortPetitions(sortBy) {
            const url = `/Home/SortedPetitions?sortBy=${sortBy}`;
            window.location.href = url;
        }
     </script>
    <script>
 

        function deletePetition(petitionId) {
            if (confirm('Are you sure you want to delete this petition?')) {
                fetch(`/Home/DeletePetition?id=${petitionId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                })
                    .then(response => {
                        if (response.ok) {
                            alert('Petition deleted successfully.');
                            window.location.reload(); // Reload the page to update the list
                        } else {
                            alert('Error deleting petition.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Failed to delete petition.');
                    });
            }
        }
    </script>
</body>
<footer class="plfooter">
    &copy; 2024 - iPétition - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
</footer>
</html>
